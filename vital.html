<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="VitÃ¡l">
<title>VitÃ¡l</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,300&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THEMES â€” Dark & Light only
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --safe-top:    env(safe-area-inset-top,0px);
  --safe-bottom: env(safe-area-inset-bottom,0px);
  --r-sm:12px; --r-md:16px; --r-lg:22px; --r-xl:28px; --r-full:100px;
  --px: 24px; /* consistent horizontal padding */

  --sage:       #5EBF78; --sage-d:#3D9A58; --sage-l:rgba(94,191,120,.14); --sage-b:rgba(94,191,120,.35);
  --rose:       #C4847A; --rose-l:rgba(196,132,122,.12); --rose-b:rgba(196,132,122,.30);
  --amber:      #D4A055; --amber-l:rgba(212,160,85,.14); --amber-b:rgba(212,160,85,.35);
  --sky:        #7A9EC4; --sky-l:rgba(122,158,196,.12); --sky-b:rgba(122,158,196,.30);
  --warn:       #D4804A; --warn-l:rgba(212,128,74,.12);
  --success:    #5A9E72;
}

[data-theme="dark"] {
  --bg:       #080C14; --bg2:      #0D1220;
  --surface:  #111829; --surface2: #162034;
  --border:   #1E2D45; --border2:  #263B5E;
  --ink:      #EDF2FF; --ink2:     #8BA4CC; --ink3:     #4A6080;
  --shadow-sm:0 1px 4px rgba(0,0,0,.55); --shadow-md:0 4px 20px rgba(0,0,0,.65); --shadow-lg:0 12px 40px rgba(0,0,0,.8);
  --sage:       #4D9EE8; --sage-d:#2A7ACC; --sage-l:rgba(77,158,232,.14); --sage-b:rgba(77,158,232,.35);
  --amber:      #7B9ED9; --amber-l:rgba(123,158,217,.14); --amber-b:rgba(123,158,217,.35);
  --rose:       #8A7ED9; --rose-l:rgba(138,126,217,.14); --rose-b:rgba(138,126,217,.35);
  --sky:        #5BC4D4; --sky-l:rgba(91,196,212,.14); --sky-b:rgba(91,196,212,.35);
  --warn:       #E8944A; --warn-l:rgba(232,148,74,.14);
}

[data-theme="light"] {
  --bg:       #EDEAE3; --bg2:      #E2DFD8;
  --surface:  #FAFAF8; --surface2: #EEEAE4;
  --border:   #CEC9C0; --border2:  #BCB6AC;
  --ink:      #18150F; --ink2:     #42382E; --ink3:     #7A7268;
  --shadow-sm:0 1px 4px rgba(24,21,15,.08); --shadow-md:0 4px 18px rgba(24,21,15,.12); --shadow-lg:0 12px 40px rgba(24,21,15,.16);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0}
html,body{height:100%;width:100%;overflow:hidden}
body{
  background:var(--bg);color:var(--ink);
  font-family:'DM Sans',sans-serif;font-size:14px;font-weight:400;
  -webkit-font-smoothing:antialiased;
  display:flex;flex-direction:column;height:100dvh;
  transition:background .3s,color .3s;
}
button{font-family:inherit;cursor:pointer;border:none;background:none}
input,select{font-family:inherit}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APP SHELL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.app{display:flex;flex-direction:column;height:100dvh;overflow:hidden;max-width:430px;margin:0 auto;width:100%}
.statusbar{height:calc(var(--safe-top) + 4px);background:var(--bg);flex-shrink:0;transition:background .3s}

/* â”€â”€ Header â”€â”€ */
.header{padding:6px var(--px) 10px;display:flex;justify-content:space-between;align-items:flex-end;flex-shrink:0}
.app-name{font-family:'DM Serif Display',serif;font-size:24px;color:var(--ink);letter-spacing:-.4px;transition:color .3s}
.app-date{font-size:10px;color:var(--ink3);font-weight:400;margin-top:1px;letter-spacing:.2px;transition:color .3s}
.header-actions{display:flex;gap:6px;align-items:center}

.pill-btn{
  height:30px;padding:0 11px;border-radius:var(--r-full);
  background:var(--surface);border:1px solid var(--border);
  display:flex;align-items:center;gap:4px;
  font-size:11px;font-weight:500;color:var(--ink2);
  box-shadow:var(--shadow-sm);transition:all .15s;white-space:nowrap;
}
.pill-btn:active{transform:scale(.95);background:var(--bg2)}
.pill-btn svg{flex-shrink:0;stroke:var(--ink2)}

/* â”€â”€ Tabs â”€â”€ */
.tab-bar{
  display:flex;margin:0 var(--px) 12px;
  background:var(--surface2);border-radius:var(--r-full);
  padding:3px;gap:2px;flex-shrink:0;border:1px solid var(--border);
  transition:background .3s,border-color .3s;
}
.tab-btn{
  flex:1;height:32px;border-radius:var(--r-full);
  font-size:11px;font-weight:500;color:var(--ink3);letter-spacing:.1px;
  transition:all .22s cubic-bezier(.34,1.56,.64,1);
  display:flex;align-items:center;justify-content:center;gap:4px;
}
.tab-btn.active{background:var(--surface);color:var(--ink);box-shadow:var(--shadow-sm)}
.tab-btn svg{opacity:.4;transition:opacity .2s}
.tab-btn.active svg{opacity:.8}

/* â”€â”€ Views â”€â”€ */
.view{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;display:none;flex-direction:column;padding-bottom:calc(var(--safe-bottom)+20px)}
.view.active{display:flex}
.view::-webkit-scrollbar{display:none}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HYDRATION VIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hydration-hero{padding:0 var(--px);display:flex;flex-direction:column;align-items:center;gap:6px;margin-bottom:16px}
.arc-wrap{position:relative;width:188px;height:188px;margin:4px 0 2px}
.arc-svg{position:absolute;inset:0;transform:rotate(-90deg)}
.arc-track{fill:none;stroke:var(--border2);stroke-width:8;stroke-linecap:round;transition:stroke .3s}
.arc-fill{fill:none;stroke:var(--sage);stroke-width:8;stroke-linecap:round;stroke-dasharray:565;stroke-dashoffset:565;transition:stroke-dashoffset 1.4s cubic-bezier(.19,1,.22,1),stroke .5s}
.arc-fill.over{stroke:var(--warn)}
.arc-center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:0}
.arc-ml{font-family:'DM Serif Display',serif;font-size:46px;color:var(--ink);line-height:1;letter-spacing:-2px;transition:color .3s}
.arc-ml.over{color:var(--warn)}
.arc-lbl{font-size:10px;font-weight:400;color:var(--ink3);letter-spacing:.8px;text-transform:uppercase;margin-top:3px;transition:color .3s}

.status-chip{
  padding:4px 13px;border-radius:var(--r-full);
  font-size:11px;font-weight:400;
  border:1px solid var(--border);background:var(--surface);color:var(--ink2);
  transition:all .3s;display:inline-flex;align-items:center;gap:5px;
}
.status-chip.goal{background:var(--sage-l);border-color:var(--sage-b);color:var(--sage)}
.status-chip.over{background:var(--warn-l);border-color:rgba(212,128,74,.3);color:var(--warn)}

.log-btns{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;padding:0 var(--px);margin-bottom:10px}
.log-btn{
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--r-lg);padding:13px 6px 11px;
  display:flex;flex-direction:column;align-items:center;gap:6px;
  box-shadow:var(--shadow-sm);transition:all .15s;
}
.log-btn:active{transform:scale(.92);border-color:var(--sage-b)}
.log-btn-ico{width:38px;height:38px;border-radius:50%;background:var(--sage-l);display:flex;align-items:center;justify-content:center;font-size:18px;transition:background .3s}
.log-btn-lbl{font-size:10px;font-weight:500;color:var(--ink2);transition:color .3s}

.action-row{display:flex;align-items:center;justify-content:center;gap:12px;height:30px;margin-bottom:8px}
.undo-btn,.reset-btn{
  display:flex;align-items:center;gap:4px;
  font-size:11px;font-weight:400;color:var(--ink3);
  padding:3px 10px;border-radius:var(--r-full);
  transition:opacity .2s,transform .2s,color .2s;
}
.undo-btn{opacity:0;pointer-events:none;transform:translateY(3px)}
.undo-btn.show{opacity:1;pointer-events:auto;transform:translateY(0)}
.undo-btn:active{color:var(--sage)}
.reset-btn:active{color:var(--rose)}

.streak-row{margin:0 var(--px) 10px;background:var(--surface);border:1px solid var(--border);border-radius:var(--r-xl);padding:11px 14px;display:flex;align-items:center;gap:10px;box-shadow:var(--shadow-sm);transition:all .3s}
.streak-ico{width:36px;height:36px;border-radius:50%;background:var(--amber-l);display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.streak-val{font-size:14px;font-weight:500;color:var(--amber)}
.streak-lbl{font-size:10px;color:var(--ink3);font-weight:400;margin-top:1px;transition:color .3s}

/* â”€â”€ Cards â”€â”€ */
.section-card{margin:0 var(--px) 10px;background:var(--surface);border:1px solid var(--border);border-radius:var(--r-xl);overflow:hidden;box-shadow:var(--shadow-sm);transition:background .3s,border-color .3s}
.section-header{padding:13px 16px 9px;display:flex;align-items:center;justify-content:space-between}
.section-title{font-size:10px;font-weight:500;color:var(--ink3);letter-spacing:.8px;text-transform:uppercase;transition:color .3s}
.section-action{font-size:11px;font-weight:400;color:var(--sage);cursor:pointer}
.history-row{display:flex;align-items:center;justify-content:space-between;padding:8px 16px;border-top:1px solid var(--border);transition:border-color .3s}
.h-amount{font-weight:500;color:var(--ink);font-size:13px;transition:color .3s}
.h-time{font-size:10px;color:var(--ink3);font-weight:400;transition:color .3s}
.history-empty{padding:16px 16px;color:var(--ink3);font-size:11px;text-align:center;font-weight:400;transition:color .3s}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUPPLEMENTS VIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.supps-header{padding:0 var(--px) 12px;display:flex;align-items:center;justify-content:space-between}
.supps-summary{font-size:11px;color:var(--ink3);font-weight:400;transition:color .3s}
.add-btn{
  height:32px;padding:0 13px;background:var(--sage);color:#fff;
  border-radius:var(--r-full);font-size:11px;font-weight:500;
  display:flex;align-items:center;gap:4px;
  box-shadow:0 3px 10px var(--sage-b);transition:all .15s;
}
.add-btn:active{transform:scale(.95)}

/* Supplement cards */
.supp-card{margin:0 var(--px) 8px;background:var(--surface);border:1px solid var(--border);border-radius:var(--r-xl);overflow:hidden;box-shadow:var(--shadow-sm);transition:background .3s,border-color .3s}
.supp-card.inactive{opacity:.45}
.supp-card-main{display:flex;align-items:center;padding:11px 13px;gap:9px}
.supp-icon{width:42px;height:42px;border-radius:var(--r-md);display:flex;align-items:center;justify-content:center;font-size:19px;flex-shrink:0}
.supp-icon.pill{background:var(--rose-l)}.supp-icon.powder{background:var(--amber-l)}.supp-icon.liquid{background:var(--sky-l)}
.supp-info{flex:1;min-width:0}
.supp-name{font-size:13px;font-weight:500;color:var(--ink);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:color .3s}
.supp-meta{font-size:10px;color:var(--ink3);font-weight:400;margin-top:2px;transition:color .3s}
.supp-badge{display:inline-flex;align-items:center;gap:3px;background:var(--sage-l);border:1px solid var(--sage-b);color:var(--sage);font-size:10px;font-weight:400;padding:2px 7px;border-radius:var(--r-full);margin-top:3px}
.supp-badge.not-today{background:transparent;border-color:var(--border);color:var(--ink3)}
.supp-badge.reminder-on{background:var(--amber-l);border-color:var(--amber-b);color:var(--amber)}

.supp-actions{display:flex;align-items:center;gap:6px;flex-shrink:0}
.edit-btn{height:26px;padding:0 9px;border-radius:var(--r-full);font-size:10px;font-weight:500;color:var(--ink3);background:var(--surface2);border:1px solid var(--border);display:flex;align-items:center;gap:3px;transition:all .15s}
.edit-btn:active{background:var(--bg2)}

.check-btn{width:32px;height:32px;border-radius:50%;border:1.5px solid var(--border2);display:flex;align-items:center;justify-content:center;background:var(--surface);transition:all .22s cubic-bezier(.34,1.56,.64,1);flex-shrink:0}
.check-btn.done{background:var(--sage);border-color:var(--sage)}
.check-btn svg{opacity:0;transform:scale(.5);transition:all .2s}
.check-btn.done svg{opacity:1;transform:scale(1)}
.check-btn:active{transform:scale(.88)}

.supp-log-bar{border-top:1px solid var(--border);padding:7px 13px;display:flex;align-items:center;gap:7px;background:var(--bg);transition:background .3s,border-color .3s}
.supp-log-bar input{flex:1;max-width:88px;height:30px;background:var(--surface);border:1px solid var(--border);border-radius:var(--r-md);padding:0 9px;font-size:13px;color:var(--ink);font-weight:400;outline:none;transition:border-color .2s,background .3s,color .3s}
.supp-log-bar input:focus{border-color:var(--sage-b)}
.supp-unit{font-size:10px;color:var(--ink3);font-weight:400;white-space:nowrap;transition:color .3s}
.log-dose-btn{height:30px;padding:0 11px;background:var(--sage-l);color:var(--sage);border-radius:var(--r-md);font-size:11px;font-weight:500;border:1px solid var(--sage-b);transition:all .15s}
.log-dose-btn:active{background:var(--sage-b);transform:scale(.95)}

.supp-logs{padding:0 13px 9px;display:flex;flex-wrap:wrap;gap:5px}
.supp-log-pill{background:var(--surface2);border:1px solid var(--border);border-radius:var(--r-full);padding:2px 8px;font-size:10px;font-weight:400;color:var(--ink2);transition:all .3s}

.supps-empty{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px var(--px);text-align:center;gap:10px}
.supps-empty-icon{font-size:44px}
.supps-empty-title{font-family:'DM Serif Display',serif;font-size:20px;color:var(--ink);transition:color .3s}
.supps-empty-sub{font-size:12px;color:var(--ink3);line-height:1.6;font-weight:400;transition:color .3s}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOTTOM SHEETS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay{position:fixed;inset:0;z-index:100;background:rgba(0,0,0,.5);backdrop-filter:blur(8px);display:none;align-items:flex-end;justify-content:center}
.overlay.open{display:flex;animation:fadeIn .2s}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}

.sheet{
  width:100%;max-width:430px;
  background:var(--surface);
  border-radius:var(--r-xl) var(--r-xl) 0 0;
  padding-top:0;
  padding-left:24px;
  padding-right:24px;
  padding-bottom:calc(var(--safe-bottom)+28px);
  animation:slideUp .3s cubic-bezier(.19,1,.22,1);
  max-height:92dvh;overflow-y:auto;
  transition:background .3s;
  box-sizing:border-box;
}

.sheet::-webkit-scrollbar{display:none}
@keyframes slideUp{from{transform:translateY(60px);opacity:0}to{transform:translateY(0);opacity:1}}
.drag-pill{width:32px;height:3px;background:var(--border2);border-radius:2px;margin:12px auto 18px;transition:background .3s}
.sheet-title{font-family:'DM Serif Display',serif;font-size:21px;color:var(--ink);margin-bottom:3px;transition:color .3s}
.sheet-sub{font-size:12px;color:var(--ink2);margin-bottom:18px;font-weight:400;transition:color .3s}

/* Form elements */
.field-label{font-size:10px;font-weight:600;color:var(--ink2);letter-spacing:.8px;text-transform:uppercase;margin-bottom:6px;display:block;transition:color .3s}
.field-input{width:100%;height:46px;background:var(--bg);border:1.5px solid var(--border2);border-radius:var(--r-md);padding:0 13px;font-size:15px;color:var(--ink);font-weight:400;outline:none;margin-bottom:13px;transition:border-color .2s,background .3s,color .3s}
.field-input:focus{border-color:var(--sage-b)}
.field-select{width:100%;height:46px;background:var(--bg);border:1.5px solid var(--border);border-radius:var(--r-md);padding:0 13px;font-size:14px;color:var(--ink);font-weight:400;outline:none;margin-bottom:13px;transition:border-color .2s,background .3s,color .3s;appearance:none;-webkit-appearance:none}
.field-select:focus{border-color:var(--sage-b)}

/* Chip grids */
.chip-row{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:13px}
.chip{padding:6px 12px;border-radius:var(--r-full);border:1.5px solid var(--border2);background:var(--surface);font-size:12px;font-weight:400;color:var(--ink);cursor:pointer;transition:all .15s}
.chip.sel{border-color:var(--sage-b);background:var(--sage-l);color:var(--sage)}
.chip:active{opacity:.75}

/* Type chips */
.type-row{display:flex;gap:6px;margin-bottom:13px}
.type-chip{flex:1;padding:10px 6px;border-radius:var(--r-md);border:1.5px solid var(--border2);background:var(--surface);display:flex;flex-direction:column;align-items:center;gap:4px;font-size:11px;font-weight:500;color:var(--ink);cursor:pointer;transition:all .15s}
.type-chip .te{font-size:20px}
.type-chip.sel-pill{border-color:var(--rose-b);background:var(--rose-l);color:var(--rose)}
.type-chip.sel-powder{border-color:var(--amber-b);background:var(--amber-l);color:var(--amber)}
.type-chip.sel-liquid{border-color:var(--sky-b);background:var(--sky-l);color:var(--sky)}

/* Day-of-week chips */
.day-chips{display:flex;gap:4px;margin-bottom:13px}
.day-chip{flex:1;height:36px;border-radius:var(--r-md);border:1.5px solid var(--border2);background:var(--surface);font-size:11px;font-weight:600;color:var(--ink2);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s}
.day-chip.sel{border-color:var(--sage-b);background:var(--sage-l);color:var(--sage)}
.day-chip:active{opacity:.75}

/* Time input row */
.time-input-row{display:flex;gap:8px;align-items:center;margin-bottom:13px}
.time-input-row input[type="time"]{flex:1;height:46px;background:var(--bg);border:1.5px solid var(--border);border-radius:var(--r-md);padding:0 13px;font-size:15px;color:var(--ink);font-weight:400;outline:none;transition:border-color .2s,background .3s,color .3s;color-scheme:dark}
[data-theme="light"] .time-input-row input[type="time"]{color-scheme:light}
.time-input-row input[type="time"]:focus{border-color:var(--sage-b)}

/* Preset row */
.preset-row{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:11px}
.preset-chip{padding:5px 10px;border-radius:var(--r-full);border:1.5px solid var(--border2);background:var(--surface);font-size:12px;font-weight:400;color:var(--ink);cursor:pointer;transition:all .15s}
.preset-chip:active{background:var(--bg2)}

/* Buttons */
.btn-primary{width:100%;height:48px;background:var(--sage);color:#fff;border-radius:var(--r-xl);font-size:14px;font-weight:500;box-shadow:0 4px 12px var(--sage-b);transition:all .15s;margin-top:4px}
.btn-primary:active{transform:scale(.97)}
.btn-secondary{width:100%;height:42px;background:transparent;color:var(--ink3);border-radius:var(--r-xl);font-size:13px;font-weight:400;margin-top:5px;transition:color .3s}
.btn-danger{width:100%;height:42px;background:var(--rose-l);color:var(--rose);border-radius:var(--r-xl);font-size:13px;font-weight:500;border:1.5px solid var(--rose-b);margin-top:5px;transition:all .3s}

/* Toggle */
.toggle-row{display:flex;align-items:center;justify-content:space-between;padding:11px 0;border-bottom:1px solid var(--border);transition:border-color .3s}
.toggle-row:last-child{border-bottom:none}
.toggle-info{display:flex;flex-direction:column;gap:2px}
.toggle-label{font-size:14px;font-weight:500;color:var(--ink);transition:color .3s}
.toggle-sub{font-size:10px;color:var(--ink3);font-weight:400;transition:color .3s}
.toggle{position:relative;width:44px;height:26px;flex-shrink:0}
.toggle input{opacity:0;width:0;height:0;position:absolute}
.toggle-track{position:absolute;inset:0;cursor:pointer;background:var(--border2);border-radius:13px;transition:background .3s}
.toggle input:checked+.toggle-track{background:var(--sage)}
.toggle-thumb{position:absolute;top:3px;left:3px;width:20px;height:20px;border-radius:50%;background:#fff;box-shadow:0 1px 4px rgba(0,0,0,.2);pointer-events:none;transition:transform .26s cubic-bezier(.34,1.56,.64,1)}
.toggle input:checked~.toggle-thumb{transform:translateX(18px)}

/* Quiet hours time row */
.quiet-times{display:flex;gap:8px;margin-top:9px}
.quiet-time-field{flex:1;display:flex;flex-direction:column;gap:4px}
.quiet-time-field label{font-size:9px;font-weight:600;color:var(--ink3);letter-spacing:.7px;text-transform:uppercase;transition:color .3s}
.quiet-time-field input[type="time"]{width:100%;height:40px;background:var(--bg);border:1.5px solid var(--border);border-radius:var(--r-md);padding:0 11px;font-size:14px;color:var(--ink);outline:none;transition:all .2s;color-scheme:dark}
[data-theme="light"] .quiet-time-field input[type="time"]{color-scheme:light}
.quiet-time-field input[type="time"]:focus{border-color:var(--sage-b)}

/* Interval chips */
.interval-chips{display:flex;gap:5px;flex-wrap:wrap;margin-top:9px}
.interval-chip{padding:6px 12px;border-radius:var(--r-full);border:1.5px solid var(--border);background:var(--surface);font-size:11px;font-weight:400;color:var(--ink2);cursor:pointer;transition:all .15s}
.interval-chip.sel{border-color:var(--sage-b);background:var(--sage-l);color:var(--sage)}

/* Theme toggle (2 themes) */
.theme-toggle-row{display:flex;gap:10px;margin:12px 0 18px}
.theme-option{flex:1;border-radius:var(--r-lg);border:2px solid var(--border);padding:14px 10px;display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer;transition:all .2s}
.theme-option:active{transform:scale(.95)}
.theme-option.active{border-color:var(--sage)}
.theme-preview{width:100%;height:42px;border-radius:var(--r-md);overflow:hidden;display:flex;gap:3px;padding:5px}
.theme-preview-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.theme-option-label{font-size:11px;font-weight:500;color:var(--ink2);transition:color .3s}

/* Perm banner */
.perm-banner{background:var(--warn-l);border:1px solid rgba(212,128,74,.35);border-radius:var(--r-md);padding:9px 12px;font-size:11px;color:var(--warn);font-weight:400;line-height:1.5;margin-bottom:13px;display:none}
.perm-banner.show{display:block}

/* Supp reminder section */
.supp-reminder-section{margin-top:14px;padding-top:14px;border-top:1px solid var(--border)}
.supp-reminder-section .field-label{margin-bottom:8px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#toast{
  position:fixed;
  top:50%;left:50%;
  transform:translate(-50%,-50%) scale(.92);
  background:var(--ink);color:var(--bg);
  padding:12px 22px;border-radius:var(--r-xl);
  font-size:13px;font-weight:500;white-space:nowrap;
  opacity:0;pointer-events:none;
  transition:opacity .22s,transform .22s cubic-bezier(.34,1.56,.64,1);
  z-index:999;box-shadow:var(--shadow-lg);
}
#toast.warn{background:var(--warn);color:#fff}
#toast.sage{background:var(--sage);color:#fff}
#toast.show{opacity:1;transform:translate(-50%,-50%) scale(1)}

/* Confirm dialog */
.confirm-msg{font-size:13px;color:var(--ink2);line-height:1.55;margin-bottom:18px;font-weight:400;max-width:100%}
</style>
</head>
<body>
<div class="app">
  <div class="statusbar"></div>

  <!-- Header -->
  <div class="header">
    <div>
      <div class="app-name">VitÃ¡l</div>
      <div class="app-date" id="headerDate"></div>
    </div>
    <div class="header-actions">
      <button class="pill-btn" onclick="openThemeSheet()">
        <svg width="12" height="12" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/></svg>
        Theme
      </button>
      <button class="pill-btn" onclick="openNotifSheet()" id="notifPill">
        <svg width="12" height="12" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
        <span id="notifPillLabel">Reminders</span>
      </button>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tab-bar">
    <button class="tab-btn active" id="tabH" onclick="switchTab('hydration')">
      <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z"/></svg>
      Hydration
    </button>
    <button class="tab-btn" id="tabS" onclick="switchTab('supps')">
      <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z"/><path d="m8.5 8.5 7 7"/></svg>
      Supplements
    </button>
  </div>

  <!-- â•â• HYDRATION â•â• -->
  <div class="view active" id="viewH">
    <div class="hydration-hero">
      <div class="arc-wrap">
        <svg class="arc-svg" viewBox="0 0 200 200">
          <circle class="arc-track" cx="100" cy="100" r="90"/>
          <circle class="arc-fill" id="arcFill" cx="100" cy="100" r="90"/>
        </svg>
        <div class="arc-center">
          <div class="arc-ml" id="arcMl">0</div>
          <div class="arc-lbl" id="arcLbl">OF 3,500 ML</div>
        </div>
      </div>
      <div class="status-chip" id="statusChip">3,500 ml to go</div>
    </div>

    <div class="log-btns">
      <button class="log-btn" onclick="logWater(200)">
        <div class="log-btn-ico">â˜•</div><span class="log-btn-lbl">200 ml</span>
      </button>
      <button class="log-btn" onclick="logWater(350)">
        <div class="log-btn-ico">ğŸ¥›</div><span class="log-btn-lbl">350 ml</span>
      </button>
      <button class="log-btn" onclick="logWater(500)">
        <div class="log-btn-ico">ğŸ¥¤</div><span class="log-btn-lbl">500 ml</span>
      </button>
      <button class="log-btn" onclick="openCustomSheet()">
        <div class="log-btn-ico">âœï¸</div><span class="log-btn-lbl">Custom</span>
      </button>
    </div>

    <div class="action-row">
      <button class="undo-btn" id="undoBtn" onclick="undoWater()">
        <svg width="10" height="10" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M3 7v6h6"/><path d="M3 13A9 9 0 1 0 5.5 5.5"/></svg>
        Undo
      </button>
      <button class="reset-btn" onclick="confirmResetWater()">
        <svg width="10" height="10" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M3 2v6h6"/><path d="M21 12A9 9 0 0 0 3.86 7.5L3 8"/><path d="M21 22v-6h-6"/><path d="M3 12a9 9 0 0 0 17.14 4.5L21 16"/></svg>
        Reset day
      </button>
    </div>

    <div class="streak-row" id="streakRow" style="display:none">
      <div class="streak-ico">ğŸ”¥</div>
      <div><div class="streak-val" id="streakVal">0 days</div><div class="streak-lbl">Hydration streak</div></div>
    </div>

    <div class="section-card">
      <div class="section-header">
        <span class="section-title">Today's Log</span>
        <span class="section-action" onclick="openGoalSheet()">Edit goal</span>
      </div>
      <div id="waterHistory"><div class="history-empty">Nothing logged yet today</div></div>
    </div>
  </div>

  <!-- â•â• SUPPLEMENTS â•â• -->
  <div class="view" id="viewS">
    <div class="supps-header">
      <div class="supps-summary" id="suppsSummary">Your stack</div>
      <button class="add-btn" onclick="openAddSuppSheet()">
        <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Add
      </button>
    </div>
    <div id="suppsList"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• SHEETS â•â•â•â•â•â•â•â•â•â• -->

<!-- Custom water -->
<div class="overlay" id="customSheet" onclick="closeSheet('customSheet')">
  <div class="sheet" onclick="event.stopPropagation()" style="padding-left:24px!important;padding-right:24px!important;">
    <div class="drag-pill"></div>
    <div class="sheet-title">Log water</div>
    <div class="sheet-sub">How much did you drink?</div>
    <div class="preset-row">
      <button class="preset-chip" onclick="setCustomVal(150)">150 ml</button>
      <button class="preset-chip" onclick="setCustomVal(330)">330 ml</button>
      <button class="preset-chip" onclick="setCustomVal(750)">750 ml</button>
      <button class="preset-chip" onclick="setCustomVal(1000)">1 L</button>
    </div>
    <input class="field-input" type="number" id="customWaterInput" inputmode="numeric" placeholder="Amount in ml">
    <button class="btn-primary" onclick="confirmCustom()">Add to log</button>
    <button class="btn-secondary" onclick="closeSheet('customSheet')">Cancel</button>
  </div>
</div>

<!-- Goal -->
<div class="overlay" id="goalSheet" onclick="closeSheet('goalSheet')">
  <div class="sheet" onclick="event.stopPropagation()" style="padding-left:24px!important;padding-right:24px!important;">
    <div class="drag-pill"></div>
    <div class="sheet-title">Daily goal</div>
    <div class="sheet-sub">Set your hydration target</div>
    <div class="preset-row">
      <button class="preset-chip" onclick="setGoalVal(2000)">2 L</button>
      <button class="preset-chip" onclick="setGoalVal(2500)">2.5 L</button>
      <button class="preset-chip" onclick="setGoalVal(3000)">3 L</button>
      <button class="preset-chip" onclick="setGoalVal(3500)">3.5 L</button>
      <button class="preset-chip" onclick="setGoalVal(4000)">4 L</button>
    </div>
    <input class="field-input" type="number" id="goalInput" inputmode="numeric" placeholder="ml per day">
    <button class="btn-primary" onclick="saveGoal()">Save goal</button>
    <button class="btn-secondary" onclick="closeSheet('goalSheet')">Cancel</button>
  </div>
</div>

<!-- Confirm reset -->
<div class="overlay" id="confirmSheet" onclick="closeSheet('confirmSheet')">
  <div class="sheet" onclick="event.stopPropagation()" style="padding-left:24px!important;padding-right:24px!important;">
    <div class="drag-pill"></div>
    <div class="sheet-title">Reset today?</div>
    <div class="confirm-msg">This will clear all water logged today. Your goal and streak history will stay intact.</div>
    <button class="btn-danger" onclick="doResetWater()">Yes, reset today</button>
    <button class="btn-secondary" onclick="closeSheet('confirmSheet')">Cancel</button>
  </div>
</div>

<!-- Add / Edit supplement -->
<div class="overlay" id="addSuppSheet" onclick="closeSheet('addSuppSheet')">
  <div class="sheet" onclick="event.stopPropagation()" style="padding-left:24px!important;padding-right:24px!important;">
    <div class="drag-pill"></div>
    <div class="sheet-title" id="addSuppTitle">Add supplement</div>
    <div class="sheet-sub">What are you tracking?</div>

    <label class="field-label">Name</label>
    <input class="field-input" type="text" id="suppName" placeholder="e.g. Vitamin D3">

    <label class="field-label">Type</label>
    <div class="type-row">
      <div class="type-chip" id="tc-pill" onclick="selectType('pill')"><span class="te">ğŸ’Š</span>Pill</div>
      <div class="type-chip" id="tc-powder" onclick="selectType('powder')"><span class="te">ğŸ¥„</span>Powder</div>
      <div class="type-chip" id="tc-liquid" onclick="selectType('liquid')"><span class="te">ğŸ’§</span>Liquid</div>
    </div>

    <label class="field-label">Default dose</label>
    <div style="display:flex;gap:8px;align-items:center;margin-bottom:13px">
      <input class="field-input" type="number" id="suppDose" inputmode="decimal" placeholder="Amount" style="margin-bottom:0;flex:1">
      <span style="font-size:11px;font-weight:400;color:var(--ink3);white-space:nowrap;transition:color .3s" id="suppUnitLabel">pills</span>
    </div>

    <label class="field-label">Days of week</label>
    <div class="day-chips" id="dayChips">
      <div class="day-chip" data-day="0" onclick="toggleDay(this)">Su</div>
      <div class="day-chip" data-day="1" onclick="toggleDay(this)">Mo</div>
      <div class="day-chip" data-day="2" onclick="toggleDay(this)">Tu</div>
      <div class="day-chip" data-day="3" onclick="toggleDay(this)">We</div>
      <div class="day-chip" data-day="4" onclick="toggleDay(this)">Th</div>
      <div class="day-chip" data-day="5" onclick="toggleDay(this)">Fr</div>
      <div class="day-chip" data-day="6" onclick="toggleDay(this)">Sa</div>
    </div>

    <label class="field-label">Time of day</label>
    <div class="time-input-row" style="margin-bottom:13px">
      <input type="time" id="suppTime" value="08:00">
      <div style="font-size:11px;color:var(--ink3);font-weight:400;white-space:nowrap">preferred time</div>
    </div>

    <label class="field-label">Notes <span style="font-weight:300;text-transform:none;letter-spacing:0;font-size:9px">(optional)</span></label>
    <input class="field-input" type="text" id="suppNotes" placeholder="e.g. Take with food">

    <!-- Supplement Reminders -->
    <div class="supp-reminder-section">
      <div class="field-label" style="margin-bottom:10px">Reminder</div>
      <div class="toggle-row" style="padding-top:0;border-bottom:none">
        <div class="toggle-info">
          <div class="toggle-label">Reminder</div>
          <div class="toggle-sub">Get notified to take this supplement</div>
        </div>
        <label class="toggle">
          <input type="checkbox" id="suppReminderEnabled">
          <div class="toggle-track"></div><div class="toggle-thumb"></div>
        </label>
      </div>
      <div id="suppReminderDetailsRow" style="display:none;margin-top:12px">
        <div class="field-label" style="margin-bottom:7px">Reminder time</div>
        <div class="time-input-row" style="margin-bottom:14px">
          <input type="time" id="suppReminderTime" value="08:00">
        </div>
        <div class="field-label" style="margin-bottom:7px">Remind on days <span style="font-weight:400;text-transform:none;letter-spacing:0;font-size:9px">(matches supplement schedule by default)</span></div>
        <div class="day-chips" id="reminderDayChips">
          <div class="day-chip" data-rday="0" onclick="toggleReminderDay(this)">Su</div>
          <div class="day-chip" data-rday="1" onclick="toggleReminderDay(this)">Mo</div>
          <div class="day-chip" data-rday="2" onclick="toggleReminderDay(this)">Tu</div>
          <div class="day-chip" data-rday="3" onclick="toggleReminderDay(this)">We</div>
          <div class="day-chip" data-rday="4" onclick="toggleReminderDay(this)">Th</div>
          <div class="day-chip" data-rday="5" onclick="toggleReminderDay(this)">Fr</div>
          <div class="day-chip" data-rday="6" onclick="toggleReminderDay(this)">Sa</div>
        </div>
      </div>
    </div>

    <button class="btn-primary" style="margin-top:18px" onclick="saveSupp()">Save supplement</button>
    <div id="deleteSuppWrap" style="display:none">
      <button class="btn-danger" onclick="deleteSupp()">Delete supplement</button>
    </div>
    <button class="btn-secondary" onclick="closeSheet('addSuppSheet')">Cancel</button>
  </div>
</div>

<!-- Theme sheet -->
<div class="overlay" id="themeSheet" onclick="closeSheet('themeSheet')">
  <div class="sheet" onclick="event.stopPropagation()" style="padding-left:24px!important;padding-right:24px!important;">
    <div class="drag-pill"></div>
    <div class="sheet-title">Appearance</div>
    <div class="sheet-sub">Choose your theme</div>
    <div class="theme-toggle-row" id="themeToggleRow"></div>
    <button class="btn-primary" onclick="closeSheet('themeSheet')">Done</button>
  </div>
</div>

<!-- Notifications sheet (water) -->
<div class="overlay" id="notifSheet" onclick="closeSheet('notifSheet')">
  <div class="sheet" onclick="event.stopPropagation()" style="padding-left:24px!important;padding-right:24px!important;">
    <div class="drag-pill"></div>
    <div class="sheet-title">Reminders</div>
    <div class="sheet-sub">Stay on top of your routine</div>

    <div class="perm-banner" id="permBanner">Notifications are blocked. Please update your browser or device settings to enable reminders.</div>

    <div class="toggle-row">
      <div class="toggle-info">
        <div class="toggle-label">Drink reminders</div>
        <div class="toggle-sub">Get nudged to hydrate throughout the day</div>
      </div>
      <label class="toggle">
        <input type="checkbox" id="notifEnabled" onchange="handleNotifToggle()">
        <div class="toggle-track"></div><div class="toggle-thumb"></div>
      </label>
    </div>

    <div style="padding:11px 0 0">
      <div class="field-label">Remind me every</div>
      <div class="interval-chips">
        <div class="interval-chip" data-v="0.5" onclick="pickInterval(.5)">30 min</div>
        <div class="interval-chip" data-v="1"   onclick="pickInterval(1)">1 hour</div>
        <div class="interval-chip" data-v="1.5" onclick="pickInterval(1.5)">1.5 hr</div>
        <div class="interval-chip" data-v="2"   onclick="pickInterval(2)">2 hours</div>
        <div class="interval-chip" data-v="3"   onclick="pickInterval(3)">3 hours</div>
      </div>
    </div>

    <div class="toggle-row" style="margin-top:14px">
      <div class="toggle-info">
        <div class="toggle-label">Quiet hours</div>
        <div class="toggle-sub">Silence reminders between set times</div>
      </div>
      <label class="toggle">
        <input type="checkbox" id="quietEnabled" onchange="toggleQuietUI()">
        <div class="toggle-track"></div><div class="toggle-thumb"></div>
      </label>
    </div>

    <div id="quietTimesRow" class="quiet-times" style="display:none;padding-bottom:4px">
      <div class="quiet-time-field">
        <label>From</label>
        <input type="time" id="quietStart" value="22:00" onchange="saveNotif()">
      </div>
      <div class="quiet-time-field">
        <label>Until</label>
        <input type="time" id="quietEnd" value="07:00" onchange="saveNotif()">
      </div>
    </div>

    <!-- Supplement reminders summary -->
    <div style="margin-top:18px;padding-top:14px;border-top:1px solid var(--border)">
      <div class="field-label" style="margin-bottom:8px">Supplement reminders</div>
      <div id="suppRemindersSummary" style="font-size:12px;color:var(--ink2);font-weight:400;line-height:1.8"></div>
    </div>

    <button class="btn-primary" style="margin-top:18px" onclick="saveNotifAndClose()">Done</button>
  </div>
</div>

<div id="toast"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   KEYS & STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const K={water:'VT_W',date:'VT_D',goal:'VT_G',log:'VT_L',streak:'VT_ST',supps:'VT_S',sdoses:'VT_SD',schecks:'VT_SC',notif:'VT_N',theme:'VT_T'};
let water=0,GOAL=3500,waterLog=[],lastWater=0,wasOver=false;
let supplements=[],suppDoses={},suppChecks={};
let notif={enabled:false,intervalHours:2,quietEnabled:false,quietStart:'22:00',quietEnd:'07:00'};
let selInterval=2,reminderTimer=null,toastTimer=null;
let editSuppId=null,selType='pill',selDays=[],selTime='08:00',selReminderDays=[];
let suppReminderTimers={};

const THEMES=[
  {id:'dark',  label:'Dark',  bg:'#111829', accent:'#4D9EE8', sub:'#4A6080'},
  {id:'light', label:'Light', bg:'#FFFFFF', accent:'#7A9E87', sub:'#A09588'},
];
const TYPE_META={
  pill:  {emoji:'ğŸ’Š',label:'Pill',   unit:'pills'},
  powder:{emoji:'ğŸ¥„',label:'Powder', unit:'scoops'},
  liquid:{emoji:'ğŸ’§',label:'Liquid', unit:'ml'},
};
const DAYS=['Su','Mo','Tu','We','Th','Fr','Sa'];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ls  = k=>localStorage.getItem(k);
const set = (k,v)=>localStorage.setItem(k,typeof v==='string'?v:JSON.stringify(v));
const jp  = (s,fb)=>{try{return s?JSON.parse(s):fb}catch{return fb}};
const uid = ()=>Date.now().toString(36)+Math.random().toString(36).slice(2,6);
const esc = s=>String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');

function showToast(msg,type=''){
  const el=document.getElementById('toast');
  el.textContent=msg;el.className=type;el.classList.add('show');
  clearTimeout(toastTimer);toastTimer=setTimeout(()=>el.classList.remove('show'),3000);
}
function openSheet(id){document.getElementById(id).classList.add('open')}
function closeSheet(id){document.getElementById(id).classList.remove('open')}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function init(){
  const savedTheme=ls(K.theme)||'dark';
  applyTheme(savedTheme,false);

  GOAL=Number(ls(K.goal))||3500;
  const today=new Date().toDateString();
  if(ls(K.date)!==today){
    water=0;waterLog=[];suppDoses={};suppChecks={};
    set(K.date,today);set(K.water,0);set(K.log,'[]');set(K.sdoses,'{}');set(K.schecks,'{}');
  } else {
    water=Number(ls(K.water))||0;
    waterLog=jp(ls(K.log),[]);
    suppDoses=jp(ls(K.sdoses),{});
    suppChecks=jp(ls(K.schecks),{});
  }
  supplements=jp(ls(K.supps),[]);
  notif=Object.assign({enabled:false,intervalHours:2,quietEnabled:false,quietStart:'22:00',quietEnd:'07:00'},jp(ls(K.notif),{}));
  selInterval=notif.intervalHours;

  if(notif.enabled&&(!('Notification' in window)||Notification.permission!=='granted')){notif.enabled=false;set(K.notif,notif)}

  document.getElementById('headerDate').textContent=new Date().toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric'});
  wasOver=water>GOAL;
  loadStreak();updateWaterUI();renderSupps();updateNotifPill();scheduleReminders();scheduleAllSuppReminders();
  scheduleMidnightReset();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THEME â€” 2 options only
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function applyTheme(id,save=true){
  document.documentElement.setAttribute('data-theme',id);
  if(save)set(K.theme,id);
  buildThemeToggle();
}
function buildThemeToggle(){
  const cur=document.documentElement.getAttribute('data-theme');
  document.getElementById('themeToggleRow').innerHTML=THEMES.map(t=>`
    <div class="theme-option${t.id===cur?' active':''}" onclick="applyTheme('${t.id}')">
      <div class="theme-preview" style="background:${t.bg}">
        <div class="theme-preview-dot" style="background:${t.accent}"></div>
        <div class="theme-preview-dot" style="background:${t.sub}"></div>
      </div>
      <span class="theme-option-label">${t.label}</span>
    </div>`).join('');
}
function openThemeSheet(){buildThemeToggle();openSheet('themeSheet')}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function switchTab(t){
  document.getElementById('viewH').classList.toggle('active',t==='hydration');
  document.getElementById('viewS').classList.toggle('active',t==='supps');
  document.getElementById('tabH').classList.toggle('active',t==='hydration');
  document.getElementById('tabS').classList.toggle('active',t==='supps');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HYDRATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function logWater(ml){
  ml=Number(ml);lastWater=ml;water+=ml;
  waterLog.push({amount:ml,time:new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})});
  set(K.water,water);set(K.log,waterLog);
  updateWaterUI();
  document.getElementById('undoBtn').classList.add('show');
  if(navigator.vibrate)navigator.vibrate(22);
}
function undoWater(){
  if(!lastWater||!waterLog.length)return;
  water=Math.max(0,water-lastWater);waterLog.pop();lastWater=0;
  set(K.water,water);set(K.log,waterLog);
  updateWaterUI();document.getElementById('undoBtn').classList.remove('show');
  if(navigator.vibrate)navigator.vibrate([12,8,12]);
}
function confirmResetWater(){
  openSheet('confirmSheet');
}
function doResetWater(){
  water=0;waterLog=[];lastWater=0;wasOver=false;
  set(K.water,0);set(K.log,'[]');
  updateWaterUI();
  document.getElementById('undoBtn').classList.remove('show');
  closeSheet('confirmSheet');
  showToast('Day reset');
  if(navigator.vibrate)navigator.vibrate([12,8,12]);
}
function updateWaterUI(){
  const circ=2*Math.PI*90;
  const pct=Math.min(water/GOAL,1);
  const offset=circ-(circ*pct);
  const arc=document.getElementById('arcFill');
  arc.style.strokeDasharray=circ;
  arc.style.strokeDashoffset=offset;
  arc.classList.toggle('over',water>GOAL);

  document.getElementById('arcMl').textContent=water.toLocaleString();
  document.getElementById('arcMl').classList.toggle('over',water>GOAL);
  document.getElementById('arcLbl').textContent='OF '+GOAL.toLocaleString()+' ML';

  const chip=document.getElementById('statusChip');
  const isOver=water>GOAL,isGoal=water>=GOAL;
  const rem=Math.max(GOAL-water,0),exc=water-GOAL;
  if(isOver){
    chip.textContent='+'+exc.toLocaleString()+' ml over goal âš ï¸';chip.className='status-chip over';
    if(!wasOver){showToast('âš ï¸ Exceeded daily goal!','warn');if(navigator.vibrate)navigator.vibrate([50,30,50,30,80]);}
  } else if(isGoal){
    chip.textContent='Daily goal reached! ğŸ‰';chip.className='status-chip goal';updateStreak(true);
  } else {
    chip.textContent=rem.toLocaleString()+' ml to go';chip.className='status-chip';
  }
  wasOver=isOver;

  const histEl=document.getElementById('waterHistory');
  histEl.innerHTML=!waterLog.length
    ?'<div class="history-empty">Nothing logged yet today</div>'
    :[...waterLog].reverse().map(e=>`<div class="history-row"><span class="h-amount">+${Number(e.amount).toLocaleString()} ml</span><span class="h-time">${e.time}</span></div>`).join('');
}
function openGoalSheet(){document.getElementById('goalInput').value=GOAL;openSheet('goalSheet');setTimeout(()=>document.getElementById('goalInput').focus(),200)}
function setGoalVal(v){document.getElementById('goalInput').value=v}
function saveGoal(){const v=Number(document.getElementById('goalInput').value);if(v>0){GOAL=v;set(K.goal,v);wasOver=false;updateWaterUI();closeSheet('goalSheet');showToast('Goal updated','sage')}}
function openCustomSheet(){document.getElementById('customWaterInput').value='';openSheet('customSheet');setTimeout(()=>document.getElementById('customWaterInput').focus(),200)}
function setCustomVal(v){document.getElementById('customWaterInput').value=v}
function confirmCustom(){const v=Number(document.getElementById('customWaterInput').value);if(v>0){logWater(v);closeSheet('customSheet')}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STREAK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function loadStreak(){const s=jp(ls(K.streak),{count:0,lastDate:null});renderStreak(s.count)}
function updateStreak(met){
  if(!met)return;
  const today=new Date().toDateString();
  const s=jp(ls(K.streak),{count:0,lastDate:null});
  if(s.lastDate===today){renderStreak(s.count);return}
  const yesterday=new Date();yesterday.setDate(yesterday.getDate()-1);
  s.count=s.lastDate===yesterday.toDateString()?s.count+1:1;
  s.lastDate=today;set(K.streak,s);renderStreak(s.count);
}
function renderStreak(n){
  const row=document.getElementById('streakRow');
  if(n>=2){row.style.display='flex';document.getElementById('streakVal').textContent=n+' day'+(n!==1?'s':'')}
  else row.style.display='none';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUPPLEMENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function todayDow(){return new Date().getDay()}

function suppScheduledToday(s){
  if(!s.days||s.days.length===0)return true;
  return s.days.includes(todayDow());
}

function renderSupps(){
  const list=document.getElementById('suppsList');
  const summary=document.getElementById('suppsSummary');
  if(!supplements.length){
    list.innerHTML=`<div class="supps-empty"><div class="supps-empty-icon">ğŸŒ¿</div><div class="supps-empty-title">Your stack is empty</div><div class="supps-empty-sub">Add your first supplement to start tracking your daily routine.</div></div>`;
    summary.textContent='Your stack';return;
  }
  const todaySupps=supplements.filter(s=>suppScheduledToday(s));
  const done=todaySupps.filter(s=>suppChecks[s.id]).length;
  summary.textContent=todaySupps.length?`${done} / ${todaySupps.length} taken today`:'No supplements scheduled today';

  list.innerHTML=supplements.map(s=>{
    const meta=TYPE_META[s.type]||TYPE_META.pill;
    const doses=suppDoses[s.id]||[];
    const checked=!!suppChecks[s.id];
    const isToday=suppScheduledToday(s);
    const dayLabels=s.days&&s.days.length?s.days.map(d=>DAYS[d]).join(', '):'Every day';
    const timeLabel=s.specificTime||'';
    const metaStr=[s.dose+' '+meta.unit, dayLabels, timeLabel].filter(Boolean).join(' Â· ');
    const reminderDayLabels=s.reminderDays&&s.reminderDays.length?s.reminderDays.map(d=>DAYS[d]).join(','):'every day';
    const badgeHtml=s.reminderEnabled
      ?`<div class="supp-badge reminder-on">ğŸ”” ${s.reminderTime||'08:00'} Â· ${reminderDayLabels}</div>`
      :isToday
        ?`<div class="supp-badge">Scheduled today</div>`
        :`<div class="supp-badge not-today">Not today</div>`;
    const doseHistory=doses.length?`<div class="supp-logs">${doses.map(d=>`<div class="supp-log-pill">+${d.amount} ${meta.unit} Â· ${d.time}</div>`).join('')}</div>`:'';

    return `<div class="supp-card${!isToday?' inactive':''}">
      <div class="supp-card-main">
        <div class="supp-icon ${s.type}">${meta.emoji}</div>
        <div class="supp-info">
          <div class="supp-name">${esc(s.name)}</div>
          <div class="supp-meta">${esc(metaStr)}</div>
          ${badgeHtml}
        </div>
        <div class="supp-actions">
          <button class="edit-btn" onclick="openEditSuppSheet('${s.id}')">
            <svg width="9" height="9" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
            Edit
          </button>
          <button class="check-btn${checked?' done':''}" onclick="toggleCheck('${s.id}')">
            <svg width="13" height="13" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
          </button>
        </div>
      </div>
      <div class="supp-log-bar">
        <input type="number" inputmode="decimal" placeholder="${s.dose}" id="di-${s.id}">
        <span class="supp-unit">${meta.unit}</span>
        <button class="log-dose-btn" onclick="logDose('${s.id}')">Log dose</button>
      </div>
      ${doseHistory}
    </div>`;
  }).join('');
}

function toggleCheck(id){
  suppChecks[id]=!suppChecks[id];set(K.schecks,suppChecks);renderSupps();
  if(navigator.vibrate)navigator.vibrate(suppChecks[id]?[15,8,25]:15);
}
function logDose(id){
  const input=document.getElementById('di-'+id);
  const s=supplements.find(x=>x.id===id);if(!s)return;
  const amount=Number(input.value)||Number(s.dose);if(!amount)return;
  if(!suppDoses[id])suppDoses[id]=[];
  suppDoses[id].push({amount,time:new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})});
  if(!suppChecks[id]){suppChecks[id]=true;set(K.schecks,suppChecks)}
  set(K.sdoses,suppDoses);input.value='';renderSupps();
  showToast('Dose logged âœ“','sage');if(navigator.vibrate)navigator.vibrate(22);
}

/* Add / Edit form */
function openAddSuppSheet(){
  editSuppId=null;selType='pill';selDays=[];selTime='08:00';
  document.getElementById('addSuppTitle').textContent='Add supplement';
  document.getElementById('suppName').value='';
  document.getElementById('suppDose').value='';
  document.getElementById('suppNotes').value='';
  document.getElementById('suppTime').value='08:00';
  document.getElementById('suppReminderEnabled').checked=false;
  document.getElementById('suppReminderTime').value='08:00';
  document.getElementById('suppReminderDetailsRow').style.display='none';
  selReminderDays=[];
  refreshReminderDayUI();
  document.getElementById('deleteSuppWrap').style.display='none';
  refreshTypeUI();refreshDayUI();updateUnitLabel();
  openSheet('addSuppSheet');
  setTimeout(()=>document.getElementById('suppName').focus(),200);
}
function openEditSuppSheet(id){
  const s=supplements.find(x=>x.id===id);if(!s)return;
  editSuppId=id;selType=s.type;selDays=[...(s.days||[])];selTime=s.specificTime||'08:00';
  document.getElementById('addSuppTitle').textContent='Edit supplement';
  document.getElementById('suppName').value=s.name;
  document.getElementById('suppDose').value=s.dose;
  document.getElementById('suppNotes').value=s.notes||'';
  document.getElementById('suppTime').value=selTime;
  document.getElementById('suppReminderEnabled').checked=!!s.reminderEnabled;
  document.getElementById('suppReminderTime').value=s.reminderTime||s.specificTime||'08:00';
  document.getElementById('suppReminderDetailsRow').style.display=s.reminderEnabled?'block':'none';
  selReminderDays=[...(s.reminderDays||s.days||[])];
  refreshReminderDayUI();
  document.getElementById('deleteSuppWrap').style.display='block';
  refreshTypeUI();refreshDayUI();updateUnitLabel();
  openSheet('addSuppSheet');
}

/* Supplement reminder toggle */
document.getElementById('suppReminderEnabled').addEventListener('change',function(){
  document.getElementById('suppReminderDetailsRow').style.display=this.checked?'block':'none';
  if(this.checked) syncReminderDaysToSupp();
});

function selectType(t){selType=t;refreshTypeUI();updateUnitLabel()}
function refreshTypeUI(){
  ['pill','powder','liquid'].forEach(t=>{
    document.getElementById('tc-'+t).className='type-chip'+(t===selType?' sel-'+t:'');
  });
}
function updateUnitLabel(){document.getElementById('suppUnitLabel').textContent=TYPE_META[selType]?.unit||'units'}
function toggleDay(el){
  const d=Number(el.dataset.day);
  const i=selDays.indexOf(d);
  if(i>=0)selDays.splice(i,1);else selDays.push(d);
  el.classList.toggle('sel',selDays.includes(d));
}
function toggleReminderDay(el){
  const d=Number(el.dataset.rday);
  const i=selReminderDays.indexOf(d);
  if(i>=0)selReminderDays.splice(i,1);else selReminderDays.push(d);
  el.classList.toggle('sel',selReminderDays.includes(d));
}
function refreshReminderDayUI(){
  document.querySelectorAll('#reminderDayChips .day-chip').forEach(c=>c.classList.toggle('sel',selReminderDays.includes(Number(c.dataset.rday))));
}
function syncReminderDaysToSupp(){
  // Default reminder days to match supplement schedule days
  if(!selReminderDays.length){
    selReminderDays=[...selDays];
    refreshReminderDayUI();
  }
}
function refreshDayUI(){
  document.querySelectorAll('#dayChips .day-chip').forEach(c=>c.classList.toggle('sel',selDays.includes(Number(c.dataset.day))));
}
function saveSupp(){
  const name=document.getElementById('suppName').value.trim();
  if(!name){document.getElementById('suppName').focus();return}
  const reminderEnabled=document.getElementById('suppReminderEnabled').checked;
  const obj={
    name,type:selType,
    dose:document.getElementById('suppDose').value,
    days:[...selDays],
    specificTime:document.getElementById('suppTime').value,
    notes:document.getElementById('suppNotes').value.trim(),
    reminderEnabled,
    reminderTime:document.getElementById('suppReminderTime').value,
    reminderDays:[...selReminderDays],
  };
  if(editSuppId){Object.assign(supplements.find(x=>x.id===editSuppId),obj)}
  else{supplements.push({id:uid(),...obj})}
  set(K.supps,supplements);closeSheet('addSuppSheet');renderSupps();
  scheduleAllSuppReminders();
  showToast(editSuppId?'Supplement updated':'Supplement added âœ“','sage');
}
function deleteSupp(){
  if(!editSuppId||!confirm('Remove this supplement?'))return;
  clearSuppReminder(editSuppId);
  supplements=supplements.filter(x=>x.id!==editSuppId);
  delete suppDoses[editSuppId];delete suppChecks[editSuppId];
  set(K.supps,supplements);set(K.sdoses,suppDoses);set(K.schecks,suppChecks);
  closeSheet('addSuppSheet');renderSupps();showToast('Supplement removed');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUPPLEMENT REMINDERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function scheduleAllSuppReminders(){
  // Clear existing
  Object.keys(suppReminderTimers).forEach(clearSuppReminder);
  supplements.forEach(s=>{
    if(s.reminderEnabled)scheduleSuppReminder(s);
  });
  updateSuppRemindersSummary();
}

function clearSuppReminder(id){
  if(suppReminderTimers[id]){clearTimeout(suppReminderTimers[id]);delete suppReminderTimers[id]}
}

function suppReminderScheduledToday(s){
  const days=s.reminderDays&&s.reminderDays.length?s.reminderDays:(s.days&&s.days.length?s.days:null);
  if(!days||!days.length)return true;
  return days.includes(todayDow());
}
function scheduleSuppReminder(s){
  if(!('Notification' in window)||Notification.permission!=='granted')return;
  if(!suppReminderScheduledToday(s))return;

  const now=new Date();
  const [h,m]=(s.reminderTime||'08:00').split(':').map(Number);
  const target=new Date(now);
  target.setHours(h,m,0,0);

  let ms=target.getTime()-now.getTime();
  if(ms<0)return; // already passed today
  if(isQuietNow())return;

  suppReminderTimers[s.id]=setTimeout(()=>{
    if(Notification.permission!=='granted')return;
    if(!suppReminderScheduledToday(s))return;
    if(isQuietNow())return;
    const meta=TYPE_META[s.type]||TYPE_META.pill;
    new Notification(`VitÃ¡l â€” Time for ${s.name}`,{
      body:`Take ${s.dose} ${meta.unit}${s.notes?' Â· '+s.notes:''}`,
      tag:'supp-'+s.id
    });
  },ms);
}

function updateSuppRemindersSummary(){
  const el=document.getElementById('suppRemindersSummary');
  const active=supplements.filter(s=>s.reminderEnabled);
  if(!active.length){
    el.textContent='No supplement reminders set. Edit a supplement to add one.';
    return;
  }
  el.innerHTML=active.map(s=>{const rdl=s.reminderDays&&s.reminderDays.length?s.reminderDays.map(d=>DAYS[d]).join(', '):'Every day';return`<div style="display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--border)"><span style="color:var(--ink);font-size:13px">${esc(s.name)}</span><span style="color:var(--amber);font-size:11px;text-align:right">${s.reminderTime||'08:00'}<br><span style="color:var(--ink3);font-size:10px">${rdl}</span></span></div>`}).join('');
}

/* Request notification permission for supplements */
async function ensureNotifPermission(){
  if(!('Notification' in window))return false;
  if(Notification.permission==='granted')return true;
  if(Notification.permission==='denied')return false;
  const perm=await Notification.requestPermission();
  return perm==='granted';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WATER NOTIFICATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateNotifPill(){
  const on=notif.enabled&&(typeof Notification==='undefined'||Notification.permission==='granted');
  const suppOn=supplements.some(s=>s.reminderEnabled);
  if(on||suppOn){
    document.getElementById('notifPillLabel').textContent='Reminders on';
  } else {
    document.getElementById('notifPillLabel').textContent='Reminders';
  }
}
function openNotifSheet(){
  const denied='Notification' in window&&Notification.permission==='denied';
  document.getElementById('permBanner').classList.toggle('show',denied);
  document.getElementById('notifEnabled').checked=notif.enabled;
  document.getElementById('quietEnabled').checked=notif.quietEnabled;
  document.getElementById('quietStart').value=notif.quietStart||'22:00';
  document.getElementById('quietEnd').value=notif.quietEnd||'07:00';
  document.getElementById('quietTimesRow').style.display=notif.quietEnabled?'flex':'none';
  document.querySelectorAll('.interval-chip').forEach(c=>c.classList.toggle('sel',parseFloat(c.dataset.v)===selInterval));
  updateSuppRemindersSummary();
  openSheet('notifSheet');
}
function toggleQuietUI(){
  const on=document.getElementById('quietEnabled').checked;
  document.getElementById('quietTimesRow').style.display=on?'flex':'none';
  saveNotif();
}
async function handleNotifToggle(){
  const want=document.getElementById('notifEnabled').checked;
  if(want){
    if(!('Notification' in window)){document.getElementById('notifEnabled').checked=false;showToast('Not supported in this browser');return}
    const perm=await Notification.requestPermission();
    if(perm!=='granted'){
      document.getElementById('notifEnabled').checked=false;
      document.getElementById('permBanner').classList.add('show');
      showToast('Permission denied','warn');return;
    }
    notif.enabled=true;
    new Notification('VitÃ¡l Â· Reminders on ğŸ’§',{body:`You'll be reminded every ${fmtInterval(notif.intervalHours)}.`});
  } else {notif.enabled=false}
  saveNotif();
}
function pickInterval(v){
  selInterval=v;notif.intervalHours=v;
  document.querySelectorAll('.interval-chip').forEach(c=>c.classList.toggle('sel',parseFloat(c.dataset.v)===v));
  saveNotif();
}
function saveNotif(){
  notif.quietEnabled=document.getElementById('quietEnabled').checked;
  notif.quietStart=document.getElementById('quietStart').value;
  notif.quietEnd=document.getElementById('quietEnd').value;
  notif.intervalHours=selInterval;
  set(K.notif,notif);scheduleReminders();updateNotifPill();
}
function saveNotifAndClose(){saveNotif();closeSheet('notifSheet')}

function isQuietNow(){
  if(!notif.quietEnabled)return false;
  const now=new Date();
  const [sh,sm]=notif.quietStart.split(':').map(Number);
  const [eh,em]=notif.quietEnd.split(':').map(Number);
  const cur=now.getHours()*60+now.getMinutes();
  const start=sh*60+sm,end=eh*60+em;
  if(start>end)return cur>=start||cur<end;
  return cur>=start&&cur<end;
}
function scheduleReminders(){
  clearInterval(reminderTimer);
  if(!notif.enabled)return;
  const ms=notif.intervalHours*3600000;
  reminderTimer=setInterval(()=>{
    if(isQuietNow())return;
    if(Notification.permission!=='granted')return;
    const rem=Math.max(GOAL-water,0);
    const pct=Math.round((water/GOAL)*100);
    const body=water>=GOAL?`Goal hit today! Great work ğŸ‰`:`${rem.toLocaleString()} ml to go â€” ${pct}% done. Time to drink! ğŸ’§`;
    new Notification('VitÃ¡l â€” Hydration reminder',{body});
  },ms);
}
function fmtInterval(h){if(h<1)return h*60+' min';if(h===1)return '1 hour';return h+' hours'}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MIDNIGHT RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function scheduleMidnightReset(){
  const now=new Date();
  const midnight=new Date(now);
  midnight.setHours(24,0,0,0); // next midnight
  const ms=midnight.getTime()-now.getTime();
  setTimeout(()=>{
    // Reset daily data
    water=0;waterLog=[];suppDoses={};suppChecks={};lastWater=0;wasOver=false;
    const today=new Date().toDateString();
    set(K.date,today);set(K.water,0);set(K.log,'[]');set(K.sdoses,'{}');set(K.schecks,'{}');
    // Refresh UI
    updateWaterUI();renderSupps();
    document.getElementById('undoBtn').classList.remove('show');
    // Reschedule supplement reminders for new day
    scheduleAllSuppReminders();
    // Schedule next midnight reset
    scheduleMidnightReset();
  },ms);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOOT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
init();
</script>
</body>
</html>
