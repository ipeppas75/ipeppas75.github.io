<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SuppTrack</title>
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SuppTrack">
    
    <style>
        :root {
            --bg: #f2f2f7;
            --card: #ffffff;
            --primary: #007aff;
            --success: #34c759;
            --text: #1c1c1e;
            --gray: #8e8e93;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg); color: var(--text); margin: 0; padding: 0;
            padding-top: env(safe-area-inset-top); padding-bottom: 100px;
        }

        /* Layout */
        .container { padding: 20px; max-width: 500px; margin: 0 auto; }
        header { margin-bottom: 24px; }
        h1 { font-size: 28px; margin: 0; font-weight: 800; }
        
        /* Progress Bar */
        .progress-container { background: #e5e5ea; border-radius: 10px; height: 12px; margin: 15px 0; overflow: hidden; }
        .progress-bar { background: var(--success); height: 100%; transition: width 0.3s ease; }

        /* Section Styling */
        .section-title { font-size: 13px; text-transform: uppercase; color: var(--gray); margin: 20px 0 10px 5px; font-weight: 600; }
        .card { background: var(--card); border-radius: 14px; padding: 15px; margin-bottom: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }

        /* Supplement Item */
        .supp-item { display: flex; align-items: center; justify-content: space-between; }
        .supp-info { display: flex; flex-direction: column; }
        .supp-name { font-weight: 600; font-size: 17px; }
        .supp-meta { font-size: 14px; color: var(--gray); }
        .checkbox { width: 28px; height: 28px; border-radius: 50%; border: 2px solid #d1d1d6; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .checkbox.checked { background: var(--success); border-color: var(--success); }
        .checkbox.checked::after { content: 'âœ“'; color: white; font-weight: bold; }

        /* Form / Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 100; padding: 20px; align-items: center; }
        .modal-content { background: var(--card); border-radius: 20px; padding: 20px; width: 100%; max-width: 400px; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid #ddd; font-size: 16px; }
        button { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 600; font-size: 16px; cursor: pointer; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-ghost { background: transparent; color: var(--primary); margin-top: 10px; }

        /* Navigation Bar */
        nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); display: flex; justify-content: space-around; padding: 12px 0 env(safe-area-inset-bottom); border-top: 1px solid #d1d1d6; }
        .nav-item { border: none; background: none; color: var(--gray); font-size: 11px; display: flex; flex-direction: column; align-items: center; width: auto; padding: 0; }
        .nav-item.active { color: var(--primary); }
        .nav-icon { font-size: 24px; margin-bottom: 4px; }

        /* Stats Bars */
        .chart-row { display: flex; align-items: flex-end; height: 100px; gap: 10px; margin-top: 20px; }
        .chart-bar { flex: 1; background: var(--primary); border-radius: 4px 4px 0 0; min-height: 5px; position: relative; }
        .chart-label { position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%); font-size: 10px; color: var(--gray); }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <!-- Screen: Today -->
    <div id="screen-today">
        <header>
            <h1>Today</h1>
            <div class="progress-container"><div id="main-progress" class="progress-bar" style="width: 0%"></div></div>
            <div id="progress-text" style="font-size: 14px; color: var(--gray);">0% completed</div>
        </header>
        <div id="schedule-list"></div>
    </div>

    <!-- Screen: My Supplements -->
    <div id="screen-manage" class="hidden">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h1>Supplements</h1>
                <button class="btn-primary" style="width: auto; padding: 8px 15px;" onclick="openModal()">+ Add</button>
            </div>
        </header>
        <div id="supplements-full-list"></div>
    </div>

    <!-- Screen: Stats -->
    <div id="screen-stats" class="hidden">
        <header><h1>Insights</h1></header>
        <div class="card">
            <h3>Weekly Activity</h3>
            <div class="chart-row" id="weekly-chart"></div>
        </div>
        <div class="card">
            <h3>Health Tip</h3>
            <p id="health-tip" style="color: var(--gray); line-height: 1.4;"></p>
        </div>
    </div>
</div>

<!-- Bottom Navigation -->
<nav>
    <button class="nav-item active" onclick="showScreen('today')"><span class="nav-icon">ðŸ“…</span>Today</button>
    <button class="nav-item" onclick="showScreen('manage')"><span class="nav-icon">ðŸ’Š</span>Manage</button>
    <button class="nav-item" onclick="showScreen('stats')"><span class="nav-icon">ðŸ“Š</span>Stats</button>
</nav>

<!-- Add/Edit Modal -->
<div id="modal" class="modal">
    <div class="modal-content">
        <h2 id="modal-title">New Supplement</h2>
        <input type="text" id="form-name" placeholder="Name (e.g. Creatine)">
        <input type="text" id="form-dose" placeholder="Dosage (e.g. 5g)">
        <select id="form-time">
            <option value="Pre-workout">Pre-workout</option>
            <option value="Morning">Morning</option>
            <option value="Evening">Evening</option>
            <option value="Before bed">Before bed</option>
        </select>
        <button class="btn-primary" onclick="saveSupplement()">Save Supplement</button>
        <button class="btn-ghost" onclick="closeModal()">Cancel</button>
    </div>
</div>

<script>
    // --- Data Management ---
    let supplements = JSON.parse(localStorage.getItem('supps')) || [
        { id: 1, name: 'Vitamin D3', dose: '2000 IU', time: 'Morning', taken: false },
        { id: 2, name: 'Creatine', dose: '5g', time: 'Pre-workout', taken: false },
        { id: 3, name: 'Omega-3', dose: '1000mg', time: 'Morning', taken: false },
        { id: 4, name: 'Magnesium', dose: '400mg', time: 'Before bed', taken: false },
        { id: 5, name: 'Vitamin B Complex', dose: '1 tab', time: 'Morning', taken: false },
        { id: 6, name: 'Zinc', dose: '15mg', time: 'Evening', taken: false }
    ];

    const tips = [
        "Take Vitamin D with a meal containing fat for better absorption.",
        "Consistency is key! Try to take your supplements at the same time daily.",
        "Magnesium before bed can help improve your sleep quality.",
        "Stay hydrated! Creatine requires plenty of water to be effective."
    ];

    function saveData() {
        localStorage.setItem('supps', JSON.stringify(supplements));
        renderAll();
    }

    // --- Navigation ---
    function showScreen(screen) {
        document.querySelectorAll('[id^="screen-"]').forEach(s => s.classList.add('hidden'));
        document.getElementById(`screen-${screen}`).classList.remove('hidden');
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        event.currentTarget.classList.add('active');
        if(screen === 'stats') renderStats();
    }

    // --- UI Rendering ---
    function renderAll() {
        renderToday();
        renderManage();
    }

    function renderToday() {
        const list = document.getElementById('schedule-list');
        list.innerHTML = '';
        
        const times = ['Pre-workout', 'Morning', 'Evening', 'Before bed'];
        let total = supplements.length;
        let takenCount = supplements.filter(s => s.taken).length;
        
        const progress = total > 0 ? (takenCount / total) * 100 : 0;
        document.getElementById('main-progress').style.width = `${progress}%`;
        document.getElementById('progress-text').innerText = `${Math.round(progress)}% completed today`;

        times.forEach(time => {
            const timeSupps = supplements.filter(s => s.time === time);
            if (timeSupps.length > 0) {
                list.innerHTML += `<div class="section-title">${time}</div>`;
                timeSupps.forEach(s => {
                    list.innerHTML += `
                        <div class="card supp-item" onclick="toggleTaken(${s.id})">
                            <div class="supp-info">
                                <span class="supp-name">${s.name}</span>
                                <span class="supp-meta">${s.dose}</span>
                            </div>
                            <div class="checkbox ${s.taken ? 'checked' : ''}"></div>
                        </div>`;
                });
            }
        });
    }

    function renderManage() {
        const list = document.getElementById('supplements-full-list');
        list.innerHTML = '';
        supplements.forEach(s => {
            list.innerHTML += `
                <div class="card supp-item">
                    <div class="supp-info">
                        <span class="supp-name">${s.name}</span>
                        <span class="supp-meta">${s.time} â€¢ ${s.dose}</span>
                    </div>
                    <button style="width: auto; background: none; color: #ff3b30; font-size: 14px;" onclick="deleteSupp(${s.id})">Delete</button>
                </div>`;
        });
    }

    function renderStats() {
        document.getElementById('health-tip').innerText = tips[Math.floor(Math.random() * tips.length)];
        const chart = document.getElementById('weekly-chart');
        chart.innerHTML = '';
        const days = ['M', 'T', 'W', 'T', 'F', 'S', 'S'];
        days.forEach(day => {
            const height = Math.floor(Math.random() * 80) + 20; // Simulated data
            chart.innerHTML += `<div class="chart-bar" style="height: ${height}%"><span class="chart-label">${day}</span></div>`;
        });
    }

    // --- Actions ---
    function toggleTaken(id) {
        const supp = supplements.find(s => s.id === id);
        supp.taken = !supp.taken;
        saveData();
    }

    function deleteSupp(id) {
        if(confirm('Delete this supplement?')) {
            supplements = supplements.filter(s => s.id !== id);
            saveData();
        }
    }

    function openModal() { document.getElementById('modal').style.display = 'flex'; }
    function closeModal() { document.getElementById('modal').style.display = 'none'; }

    function saveSupplement() {
        const name = document.getElementById('form-name').value;
        const dose = document.getElementById('form-dose').value;
        const time = document.getElementById('form-time').value;
        
        if (name) {
            supplements.push({ id: Date.now(), name, dose, time, taken: false });
            saveData();
            closeModal();
            document.getElementById('form-name').value = '';
        }
    }

    // Initialize
    renderAll();
</script>

</body>
</html>
